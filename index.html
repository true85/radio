<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Timeshift Radio Player</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://vjs.zencdn.net/8.3.0/video-js.css" rel="stylesheet">
<script src="https://vjs.zencdn.net/8.3.0/video.min.js"></script> <!-- video.js 8 -->
<style>
body{margin:0;background:#000;height:100vh;display:flex;flex-direction:column;font-family:sans-serif}
#controls{background:#111;color:#fff;padding:8px;display:flex;gap:8px;align-items:center;font-size:14px}
select{background:#222;color:#fff;border:1px solid #444;border-radius:4px;padding:4px 8px}
#error{color:#f44336;font-size:12px}
video{width:100%;height:100%}
</style>
</head>
<body>

<div id="controls">
  <label>방송:</label>
  <select id="stream">
    <optgroup label="KBS"><option value="kbs:25">KBS1</option></optgroup>
    <optgroup label="MBC">
      <option value="imbc:sfm">표준FM</option>
      <option value="imbc:mfm">FM4U</option>
    </optgroup>
    <optgroup label="SBS"><option value="sbs:powerfm">파워FM</option></optgroup>
  </select>

  <label>시점:</label>
  <select id="ago">
    <option value="5m">5 분 전</option>
    <option value="30m">30 분 전</option>
    <option value="1h">1 시간 전</option>
    <option value="6h">6 시간 전</option>
    <option value="7h" selected>7 시간 전</option>
    <option value="8h">8 시간 전</option>
    <option value="9h">9 시간 전</option>
  </select>

  <span id="error"></span>
</div>

<video id="player" class="video-js vjs-default-skin" controls preload="auto"
       crossorigin="anonymous"></video>

<script>
/* Shift Worker 엔드포인트 */
const SHIFT = 'https://radio-timeshift-shift.dbr666v.workers.dev/shift';

const $stream = document.getElementById('stream');
const $ago    = document.getElementById('ago');
const $error  = document.getElementById('error');
const player  = videojs('player');

function buildURL() {
  const [type, ch] = $stream.value.split(':');
  return `${SHIFT}/${$ago.value}.m3u8/${type}/${ch}`;
}

function play() {
  $error.textContent = '';
  player.pause();
  player.reset();

  player.src({ src: buildURL(), type:'application/x-mpegURL' });
  player.play().catch(() => {
    $error.textContent = '자동 재생이 차단되었습니다. ▶ 버튼을 눌러 주세요.';
  });
  player.one('error', () => { $error.textContent = '재생 오류'; });
}

$stream.addEventListener('change', play);
$ago.addEventListener('change',    play);

play(); /* 첫 로드 */
</script>
</body>
</html>
