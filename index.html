<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Radio Timeshift Player</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
<style>
body{margin:0;background:#000;font-family:sans-serif;display:flex;flex-direction:column;height:100vh}
#controls{background:#111;color:#fff;padding:8px;display:flex;gap:8px;align-items:center}
select{background:#222;color:#fff;border:1px solid #444;padding:4px 8px;border-radius:4px}
video{width:100%;height:100%}
#error{color:#f44336;font-size:.9rem}
</style>
</head>
<body>
<div id="controls">
  <label>방송:</label>
  <select id="sel">
    <optgroup label="KBS"><option value="kbs:25">KBS1</option></optgroup>
    <optgroup label="MBC"><option value="imbc:sfm">표준FM</option><option value="imbc:mfm">FM4U</option></optgroup>
    <optgroup label="SBS"><option value="sbs:powerfm">파워FM</option></optgroup>
  </select>
  <span id="error"></span>
</div>
<video id="player" controls></video>

<script>
const SHIFT = 'https://radio-timeshift-shift.dbr666v.workers.dev/shift';
const player = document.getElementById('player');
const sel    = document.getElementById('sel');
const err    = document.getElementById('error');

function buildUrl(v){const [t,c]=v.split(':');return `${SHIFT}/7h.m3u8/${t}/${c}`;}

function play(){
  err.textContent='';
  const url=buildUrl(sel.value);
  if(Hls.isSupported()){
    const hls=new Hls({backBufferLength:90});
    hls.attachMedia(player);
    hls.on(Hls.Events.MEDIA_ATTACHED,()=>hls.loadSource(url));
    hls.on(Hls.Events.ERROR,(_,d)=>{if(d.fatal)err.textContent='재생 오류';});
  }else{ player.src=url; player.load(); }
  player.play().catch(()=>err.textContent='자동재생이 차단되었습니다. ▶ 클릭');
}

sel.addEventListener('change',play); play();
</script>
</body>
</html>
