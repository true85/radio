<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>타임시프트 라디오 (Fixed Reload 25s)</title>

  <!-- Video.js 최신 -->
  <link href="https://cdn.jsdelivr.net/npm/video.js@8/dist/video-js.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/video.js@8/dist/video.min.js"></script>

  <style>
    :root{--primary:#007aff;--bg:#f7f7fa;--fg:#333;}
    *{box-sizing:border-box;}
    body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--fg);display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;}
    .wrap{background:#fff;padding:32px 40px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.1);max-width:700px;width:100%;text-align:center;}
    h1{margin:0 0 20px;font-size:2em;color:var(--primary);}
    .video-js{width:100%;height:56px;border-radius:12px;overflow:hidden;background:#2b333f;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>타임시프트 라디오</h1>
    <video id="radioPlayer" class="video-js vjs-big-play-centered" controls preload="auto"></video>
  </div>

  <script>
    /* global videojs */
    const player = videojs('radioPlayer', {
      html5:{
        vhs:{
          lowLatencyMode:true,      // LL‑HLS on
          withCredentials:false,
          maxPlaylistRetries:3
        }
      }
    });

    // Option B: force minimum 25 000 ms reload interval
    (function applyFixedReloadInterval(vjsPlayer, minMs = 25000){
      const loader = vjsPlayer.tech().vhs && vjsPlayer.tech().vhs.masterPlaylistLoader_;
      if(!loader){ console.warn('[VHS‑Patch] loader not ready'); return;}
      let lastRefresh = performance.now();
      const origRefresh = loader.mediaPlaylistLoader_.refresh.bind(loader.mediaPlaylistLoader_);
      loader.mediaPlaylistLoader_.refresh = function(){ lastRefresh = performance.now(); return origRefresh(); };
      setInterval(()=>{ if(performance.now()-lastRefresh >= minMs){ console.debug('[VHS‑Patch] force reload'); loader.mediaPlaylistLoader_.refresh(); } }, Math.floor(minMs/5));
      console.info('[VHS‑Patch] min reload', minMs,'ms');
    })(player, 25000);

    // demo URL (replace if needed)
    player.src({
      src:'https://radio-timeshift-shift.dbr666v.workers.dev/sbs/powerfm.m3u8?mode=live',
      type:'application/x-mpegURL'
    });
  </script>
</body>
</html>
