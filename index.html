<!-- radio-timeshift-ui.html (v7.1)
     âœ“ MEDIA-SEGMENT ì§„í–‰ ë²„ê·¸ / JSON parse ì˜¤ë¥˜ ìˆ˜ì •
     âœ“ Video.js 8 + VHS ê¸°ë³¸
-->
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Timeshift Radio Player</title>

    <!-- video.js 8 (VHS í¬í•¨) -->
    <link href="https://vjs.zencdn.net/8.3.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.3.0/video.min.js"></script>

    <style>
      :root {
        --bg: #000;
        --fg: #fff;
        --panel: #111;
        --border: #333;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        height: 100vh;
        display: flex;
        flex-direction: column;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      }
      #controls {
        background: var(--panel);
        padding: 8px 12px;
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
        font-size: 14px;
        border-bottom: 1px solid var(--border);
      }
      select {
        background: #222;
        color: var(--fg);
        border: 1px solid var(--border);
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 14px;
      }
      #error { color: #f44336; font-size: 12px; }
      video { width: 100%; height: 100%; background: #000; }
    </style>
  </head>
  <body>
    <!-- â–¶ ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
    <div id="controls">
      <label for="stream">ë°©ì†¡:</label>
      <select id="stream">
        <optgroup label="KBS">
          <option value="kbs:25">KBS 1 Radio</option>
        </optgroup>
        <optgroup label="SBS">
          <option value="sbs:powerfm">íŒŒì›ŒFM</option>
        </optgroup>
      </select>

      <label for="ago">ì‹œì :</label>
      <select id="ago">
        <option value="5m">5 ë¶„ ì „</option>
        <option value="10m">10 ë¶„ ì „</option>
        <option value="6h" selected>6 ì‹œê°„ ì „</option>
        <option value="7h">7 ì‹œê°„ ì „</option>
        <option value="8h">8 ì‹œê°„ ì „</option>
        <option value="9h">9 ì‹œê°„ ì „</option>
      </select>

      <span id="error"></span>
    </div>

    <!-- â–¶ Player -->
    <video id="player" class="video-js vjs-default-skin" controls preload="auto" playsinline crossorigin="anonymous"></video>

    <script>
      const SHIFT = "https://radio-timeshift-shift.dbr666v.workers.dev/shift";
      const $stream = document.getElementById("stream");
      const $ago    = document.getElementById("ago");
      const $error  = document.getElementById("error");
      const player  = videojs("player");

      // ğŸ”¸ buildURL ì€ /shift/{span}/{type}/{ch}.m3u8 í˜•ì‹ ì‚¬ìš©
      const buildURL = () => {
        const [type, ch] = $stream.value.split(":");
        return `${SHIFT}/${$ago.value}/${type}/${ch}.m3u8`;
      };

      const humanError = err => {
        switch ((err?.code) ?? -1) {
          case 4: return "ì¬ìƒí•  ìˆ˜ ì—†ëŠ” ë¯¸ë””ì–´ (404/403)";
          case 2: return "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ (ì„¸ê·¸ë¨¼íŠ¸ ëˆ„ë½)";
          default: return "ì¬ìƒ ì˜¤ë¥˜";
        }
      };

      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      player.ready(() => {
        // ë³µì›
        const savedStream = localStorage.getItem("stream");
        const savedAgo    = localStorage.getItem("ago");
        if (savedStream) $stream.value = savedStream;
        if (savedAgo)    $ago.value    = savedAgo;

        const setSource = () => {
          localStorage.setItem("stream", $stream.value);
          localStorage.setItem("ago",    $ago.value);

          $error.textContent = "";
          player.reset(); // ì§„ì…ì  ë¦¬ì…‹ âœ¨
          player.src({ src: buildURL(), type: "application/x-mpegURL" });
          player.play().catch(() => {
            $error.textContent = "ë¸Œë¼ìš°ì €ê°€ ìë™ ì¬ìƒì„ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤. â–¶ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.";
          });
        };

        setSource();
        player.on("error", () => { $error.textContent = humanError(player.error()); });
        $stream.addEventListener("change", setSource);
        $ago.addEventListener("change",    setSource);
      });
    </script>
  </body>
</html>
